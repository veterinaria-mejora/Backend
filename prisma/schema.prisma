// =====================
// Prisma Configuration
// =====================

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// =====================
// USERS
// =====================

model users {
  idusuario     Int      @id @default(autoincrement())
  name          String?
  lastname      String?
  email         String   @unique
  password_hash String
  role          String   @default("user")
  created_at    DateTime @default(now())

  // relations
  animales        animal[]          @relation("UserAnimales")
  password_resets password_resets[]
  cart_items      cart_item[]
  orders          order[]

  regconsults     consultas[]       @relation("UserConsultas")

  @@map("users")
}

// =====================
// PASSWORD RESETS
// =====================

model password_resets {
  id              Int       @id @default(autoincrement())
  user_id         Int
  reset_token     String?
  expiration_date DateTime?

  // relations
  user users @relation(fields: [user_id], references: [idusuario])

  @@map("password_resets")
}

// =====================
// FORMULARIOS
// =====================

model formulario {
  idformulario                 Int     @id @default(autoincrement())
  nombre                       String?
  apellido                     String?
  telefono                     Int?
  mail                         String?
  fecha_nacimiento             String?
  direccion                    String?
  ciudad                       String?
  provincia                    String?
  codigo_postal                Int?
  pais                         String?
  tipo_documento               String?
  numero_documento             Int?
  tipo_vivienda                String
  espacio_seguro               String
  tiempo_solo                  Int
  personas_encasa              Int
  familia_deacuerdo            String
  otras_mascotas_anteriormente String
  tipo                         String
  eventos                      String
  otras_mascotas_actualmente   Int
  tipo_mascotas_actual         String
  recursos                     String
  vacunar_y_esterilizar        String
  encargado_cuidado            String
  sitio_animal_solo            String
  rol_del_animal               String
  estado                       String

  @@map("formulario")
}

// =====================
// PRODUCTS
// =====================

model productos {
  idproducto Int     @id @default(autoincrement())
  nombre     String?
  url_imagen String?
  stock      Int
  precio     Float   @default(0)

  // relations
  compras     compra[]
  cart_items  cart_item[]
  order_items order_item[]

  @@map("productos")
}

// =====================
// PURCHASES
// =====================

model compra {
  idcompra Int  @id @default(autoincrement())
  producto Int?
  unidades Int?
  precio   Int?

  // relations
  productoRef productos? @relation(fields: [producto], references: [idproducto], onDelete: SetNull)

  @@map("compra")
}

// =====================
// ANIMALS
// =====================

model animal {
  idanimal    Int      @id @default(autoincrement())
  nombre      String?
  tipo        String?
  raza        String?
  edad        Int?
  descripcion String?
  imagen_m    String?
  adoptable   Boolean? @default(true)
  dueño      Int?

  // relations
  perfilId    Int?
  usuario     users?             @relation("UserAnimales", fields: [dueño], references: [idusuario])
  historiales historial_medico[] @relation("AnimalHistorial")

  @@map("animal")
}

// =====================
// CONSULTATIONS
// =====================

model consultas {
  idconsulta  Int      @id @default(autoincrement())
  descripcion String?

  idusuario   Int?
  usuario     users?   @relation("UserConsultas", fields: [idusuario], references: [idusuario], onDelete: SetNull)

  @@map("consultas")
}

// =====================
// MEDICAL HISTORY
// =====================

model historial_medico {
  idhistorial    Int     @id @default(autoincrement())
  mascota        Int?
  turnos_pasados String?
  vacunas        String?

  mascotaRef animal? @relation("AnimalHistorial", fields: [mascota], references: [idanimal], onDelete: SetNull)

  @@map("historial_medico")
}

// =====================
// BACKEND EXTRA MODELS
// =====================

model coupon {
  id     Int     @id @default(autoincrement())
  code   String  @unique
  active Boolean @default(true)

  @@map("coupons")
}

model cart_item {
  id         Int      @id @default(autoincrement())
  user_id    Int
  product_id Int
  quantity   Int      @default(1)
  created_at DateTime @default(now())

  user    users     @relation(fields: [user_id], references: [idusuario], onDelete: Cascade)
  product productos @relation(fields: [product_id], references: [idproducto], onDelete: Cascade)

  @@unique([user_id, product_id])
  @@map("cart_items")
}

model order {
  id             Int      @id @default(autoincrement())
  user_id        Int
  total_amount   Float
  status         String   @default("pending")
  payment_id     String?
  payment_status String?
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  user        users        @relation(fields: [user_id], references: [idusuario], onDelete: Cascade)
  order_items order_item[]

  @@map("orders")
}

model order_item {
  id         Int   @id @default(autoincrement())
  order_id   Int
  product_id Int
  quantity   Int
  price      Float

  order   order     @relation(fields: [order_id], references: [id], onDelete: Cascade)
  product productos @relation(fields: [product_id], references: [idproducto], onDelete: Cascade)

  @@map("order_items")
}
